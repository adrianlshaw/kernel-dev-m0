sudo: enabled

before_install:
        - sudo apt-get update && sudo apt-get -y install astyle make gcc-arm-none-eabi qemu-system-arm gdb-multiarch tmux

language: bash

script:
        - make PLAT=qemu
        - timeout --foreground 5 qemu-system-arm -d guest_errors -M lm3s811evb -m 8K -nographic -kernel main.elf > test.run || true
        - cat test.run
        - grep "Success" test.run

matrix:
  include:
    - env:
      - NAME=astyle
      install:
        - >-
          cd -
        - astyle --version
      script:
        - git fetch --all --unshallow --tags
        - git fetch origin "${TRAVIS_BRANCH}"
        - >-
          git diff --name-only --diff-filter=d FETCH_HEAD..HEAD \
            | ( grep '.\(c\|cpp\|h\|hpp\)$' || true ) \
            | ( fgrep -v -f .astyleignore || true ) \
            | while read file; do astyle -n --options=.astylerc "${file}"; done
        - git diff --exit-code --diff-filter=d --color
